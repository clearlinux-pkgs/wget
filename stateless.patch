From 2994c02602ff97b9a121c75d232f4e519f21ef84 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <michael.i.doherty@intel.com>
Date: Wed, 4 Feb 2015 12:56:24 +0000
Subject: [PATCH] Use system defaults directory in absence of site
 configuration

Signed-off-by: Ikey Doherty <michael.i.doherty@intel.com>
---
 doc/Makefile.am | 4 ++--
 src/Makefile.am | 2 +-
 src/init.c      | 4 ++++
 3 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/doc/Makefile.am b/doc/Makefile.am
index 0a03319..d7222aa 100644
--- a/doc/Makefile.am
+++ b/doc/Makefile.am
@@ -30,7 +30,7 @@ RM = rm -f
 TEXI2POD     = $(srcdir)/texi2pod.pl
 POD2MAN      = @POD2MAN@
 MAN          = wget.$(manext)
-WGETRC       = $(sysconfdir)/wgetrc
+WGETRC       = $(datadir)/defaults/wget/wgetrc
 SAMPLERCTEXI = sample.wgetrc.munged_for_texi_inclusion
 
 #
@@ -90,7 +90,7 @@ install.man: $(MAN)
 
 # install sample.wgetrc
 install.wgetrc: $(srcdir)/sample.wgetrc
-	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)
+	$(mkinstalldirs) $(DESTDIR)$(datadir)/defaults/wget
 	@if test -f $(DESTDIR)$(WGETRC); then \
 	  if cmp -s $(srcdir)/sample.wgetrc $(DESTDIR)$(WGETRC); then echo ""; \
 	     else \
diff --git a/src/Makefile.am b/src/Makefile.am
index 28c0be2..cff301d 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -44,7 +44,7 @@ XATTR_OBJ = xattr.c
 endif
 
 # The following line is losing on some versions of make!
-DEFS     = @DEFS@ -DSYSTEM_WGETRC=\"$(sysconfdir)/wgetrc\" -DLOCALEDIR=\"$(localedir)\"
+DEFS     = @DEFS@ -DSYSTEM_WGETRC=\"$(sysconfdir)/wgetrc\" -DLOCALEDIR=\"$(localedir)\"  -DDEFAULT_WGETRC=\"$(datadir)/defaults/wget/wgetrc\" 
 
 EXTRA_DIST = css.l css.c css_.c build_info.c.in
 
diff --git a/src/init.c b/src/init.c
index 1064883..5700361 100644
--- a/src/init.c
+++ b/src/init.c
@@ -760,6 +760,10 @@ or specify a different file using --config.\n"), env_sysrc);
     ok &= run_wgetrc (SYSTEM_WGETRC, &flstats);
   /* If there are any problems parsing the system wgetrc file, tell
      the user and exit */
+#ifdef DEFAULT_WGETRC
+  else if (file_exists_p (DEFAULT_WGETRC, NULL))
+    ok &= run_wgetrc (DEFAULT_WGETRC, &flstats);
+#endif
   if (! ok)
     {
       fprintf (stderr, _("\
